<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
 <html>

  <head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style type='text/css'>
      /* Dropdown */
       .dropdown{
        list-style:none;
       }
         .dropdown:hover ul{ display:inline-block; }
        .dropdown li{
         display:inline-block;
        }
        .dropdown ul{
         background-color:rgba(255,255,255, 1);
         border: 1px dotted rgba(181,181,181, 1);
         display:none;
         margin-left:-40px;
         padding: 1px;
         position: absolute;
         text-align:left !important;
        }
         .dropdown ul li{
          display:block !important;
          margin:1px 0px;
         }
      /* Options */
       .op{
        border:0px dotted rgba(181,181,181, 1);
         border-bottom-width:1px;
         border-top-width:1px;
        margin:2px 0px;
        padding:3px 2px 3px 2px;
        text-align:center;
       }
        .op div{ display:inline-block; }
        .op .clear{/* Clear Button */
        }
         .op .clear #clear_button{ height:21px;  }
         .op .clear .dropdown ul{ margin-top:21px; }
        .op .color_bx{/* Color Box */
        }
         .op .color_bx .show_bx{
          border:1px solid rgba(0,0,0, 1);
          hegiht:5px;
          width:15px;
         }
         .op .color_bx .preview{
          border:1px solid rgba(0,0,0, 1);
          hegiht:3px;
          width:9px;
         }
      /* Search Form */
       #search_form{
        margin:0px 0px 8px 0px;
       }
        #search_form #find{
          width:70% !important;
        }
        #search_form .button{
          display:none !important;
          width: 25% !important;
        }
    </style>
  </head>

  <body>
   <div id='search_form' action='' method='get'>
    <input type='text' name='find' id='find' placeholder='search for...' value=''>
    <input type='submit' id='search_button' class='button' value='search'>
   </div>
   <div id='options' class='op'>
    <div id='color_box' class='color_bx'>
     <li id='color_hub' class='dropdown'>
      <div id='color_show_box' class='show_bx' style='background-color:#FFFF00;'>&nbsp;</div>
      <div id='color_show_text' class='show_text'>Yellow</div>
      <ul id='color_list' class='list'>
       <li><div id='color_brown' class='preview' style='background-color:#A52A2A; !important;' hex='A52A2A' rgb='165,42,42'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'brown' })">Brown</a></div></li>
       <li><div id='color_black' class='preview' style='background-color:#000000; !important;' hex='000000' rgb='0,0,0'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'black' })">Black</a></div></li>
       <li><div id='color_blue' class='preview' style='background-color:#0000FF; !important;' hex='0000FF' rgb='0,0,255'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'blue' })">Blue</a></div></li>
       <li><div id='color_cyan' class='preview' style='background-color:#00FFFF; !important;' hex='00FFFF' rgb='0,255,255'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'cyan' })">Cyan</a></div></li>
       <li><div id='color_gray' class='preview' style='background-color:#808080; !important;' hex='808080' rgb='128,128,128'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'gray' })">Gray</a></div></li>
       <li><div id='color_green' class='preview' style='background-color:#008000; !important;' hex='008000' rgb='0,128,0'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'green' })">Green</a></div></li>
       <li><div id='color_orange' class='preview' style='background-color:#FFA500; !important;' hex='FFA500' rgb='255,165,0'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'orange' })">Orange</a></div></li>
       <li><div id='color_pink' class='preview' style='background-color:#FFC0CB; !important;' hex='FFC0CB' rgb='255,192,203'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'pink' })">Pink</a></div></li>
       <li><div id='color_purple' class='preview' style='background-color:#800080; !important;' hex='800080' rgb='128,0,128'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'purple' })">Purple</a></div></li>
       <li><div id='color_red' class='preview' style='background-color:#FF0000; !important;' hex='FF0000' rgb='255,0,0'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'red' })">Red</a></div></li>
       <li><div id='color_yellow' class='preview' style='background-color:#FFFF00; !important;' hex='FFFF00' rgb='255,255,0'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'yellow' })">Yellow</a></div></li>
       <li><div id='color_white' class='preview' style='background-color:#FFFFFF; !important;' hex='FFFFFF' rgb='255,255,255'>&nbsp;</div> <div class='color_text'><a onclick="setColor({ color:'white' })">White</a></div></li>
      </ul>
     </li>
    </div>
    <div id='clear' class='clear'>
     <li id='clear_dd' class='dropdown'>
      <button id='clear_button'>clear</button>
      <ul id='clear_dd_list' class='list'>
       <li id='clear_all' onclick='clear_dx({ all:true })'>clear all</li>
      </ul>
     </li>
    </div>
   </div>

   <div id='search_list'></div>

    <button id="helloButton" style='margin-top:15px;'>say hi</button>
</body>

<script>
    Office.onReady((info) => {
        // Check that we loaded into Word
        if (info.host === Office.HostType.Word) {
            document.getElementById("helloButton").onclick = sayHello;
            document.getElementById("search_button").setAttribute('style','display:inline-block !important;');
            document.getElementById("search_button").onclick = search;
        }
    });
 
    //variables
     var highlight_color='FFFF00';//highlight color - defaults to yellow
     const results=[];//search results
     const res_info=[];//results info

    function sayHello() {
        return Word.run((context) => {

            // insert a paragraph at the start of the document.
            const paragraph = context.document.body.insertParagraph("Hello World", Word.InsertLocation.start);
            
            // sync the context to run the previous API call, and return.
            return context.sync();
        });
    }

    function tracker(attrs){
     //vars
      var obj=(attrs.obj) || (attrs.objective) || null;
     //
      //checks the objective
       if(obj=='add_clear'||obj=='add_search'){//adds a search to the clear list
        //vals
         var res_index=(attrs.result) || (attrs.result_index) || (attrs.index) || null;//result index
         var srh_query=(attrs.search) || (attrs.query) || null;//search query
          var srh_query_c=srh_query.replace("'", "\'");//text sterilization
         var add_exists=document.getElementById('clear_dx_'+srh_query_c);
         var add_already=null;//
          if(add_exists!=null){ var add_check=add_exists.getAttribute('set'); if(add_check==1){ add_already=true; } }
         var fx_box=null; var el_start=null; var el_end=null;//focus box, start & end element tags
          if(obj=='add_search'){ fx_box='search_list'; el_start='<div>'; el_end='</div>'; }
          else{ fx_box='clear_dd_list'; el_start='<li>'; el_end='</li>'; }
        //
         //checks if the query was already added
          if(add_already===null){
           //builds the clearage link
            var cur_doc=document.getElementById(fx_box).innerHTML;//gets the clear list content
            var new_clear=el_start+"<a id='clear_dx_"+srh_query_c+"' set='1' href='' onclick='clear_dx({ index:\''+res_index+'\' });'>"+srh_query+"</a>"+el_end;
            var new_doc=cur_doc + new_clear;//appends the new clear link to the clear list
            //adds the clearage link
             document.getElementById(fx_box).innerHTML = new_doc;//updates the clear list
          }
       }
    }

    function clear_dx(attrs){//clears searches
     //vars
      var all=(attrs.all) || (attrs.clear_all) || (attrs['clear all']) || null;//clear all flag
      var index=(attrs.index) || (attrs.result) || (attrs.result_index) || (attrs['result index']) || (attrs.res_index) || (attrs['res index']) || null;//result index
     //checks what to do
      if(all===true){//if all highlight are to be cleared
       
      }
      else{//regular individual clearance
       if(index!=null){//if a non-empty index has been provided
       }
      }
    }
 
    function setColor(attrs){
     //vars
      var color=attrs.color;//the color
      var hex=attrs.hex;//color hex
      var rgb=attrs.rgb;//color rgb
      var alpha=attrs.alpha;//color rgb alpha
     //
      //attempts to get the color hex & rgb
       var h_color=document.getElementById('color_'+color).getAttribute('hex');//gets the hex color
       var rgb_color=document.getElementById('color_'+color).getAttribute('rgb');//gets the hex color
      //changes the color
       highlight_color='#' + h_color;//attemps to change the highlight color
       var color_name_upper=(color[0].toUpperCase())+(color.slice(1));
       //changes the color display box
        document.getElementById('color_show_box').setAttribute('style','background-color: #'+h_color+' !important;');
        document.getElementById('color_show_text').innerHTML=color_name_upper;
       //changes the highlight color
        highlight_color=h_color;
    }
  
     function search(){
      //varaibles
       var query=null;//query text
       var loop_count=0;//loop counter
       var hl_color=highlight_color;//set the highlight color to reference the main one
       const finds=[];//results container
       console.log(hl_color+' | '+highlight_color);
      //
       //gets the query text
        query=document.getElementById('find').value;
       //performs the search
        return Word.run(async(context) => {
          const search=context.document.body.search(query);//searches the document
          //stores the search results
           var si=results.length;//gets the result index
            if(si<0){ si=0; }
           results[si]=search;//storage
           res_info[si]=[//results info allocation
            false,//0: search performance
            null,//1: highlight flag
            null,//2: highlight color
           ];
          search.load('font');//loads the font property value
          await context.sync();//syncs the document
          //adds the search to the search & clear list
           tracker({ index:loop_count, query:query, obj:'add_clear' });
           tracker({ index:loop_count, query:query, obj:'add_search' });
          //clears the last search results
           var c_counter=0;//clear counter
           var csi=(si<=0) ? 0 : (si-1);
           var c_m_counter=(results[(csi)]).items.length;//gets the counter length
           for(c_counter=0; c_counter<c_m_counter; c_counter++){//loops through the old search results and removes the highlight
            search.items[c_counter].font.highlightColor='#' + hl_color;//removes the highlight
           }
           //
          //process the results
           for(loop_count=0; loop_count<search.items.length; loop_count++){//loops through the search results
            search.items[loop_count].font.highlightColor='#'+hl_color;//hgihtlights the text
            //adds the result info
             res_info[si][loop_count]=[ true, 1, hl_color ];
              //res_info[si][loop_count][1]=true;//sets the results true flag
              //res_info[si][loop_count][2]=hl_color;//sets the results true flag
             console.log(res_info[si][loop_count]);
            //search.items[loop_count].font.bold=true;
            //search.items[loop_count].font.italic=true;
           }
           return context.sync();//syncs the document
        });
     }
</script>

</html>
